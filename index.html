<button id="submit-button" onclick="submitLetter()">편지 보내기</button>

<script>
  async function submitLetter() {
    const submitButton = document.getElementById("submit-button");
    const letterInput = document.getElementById("letter-input");
    const categorySelect = document.getElementById("category-select");
    const letterText = letterInput.value.trim();
    const category = categorySelect.value;

    // 입력값 검증
    if (!category) {
      alert("카테고리를 선택하세요.");
      return;
    }

    if (letterText.length === 0) {
      alert("내용을 입력하세요.");
      return;
    } else if (letterText.length > maxChars) {
      alert(`편지는 ${maxChars}자 이내로 작성해주세요.`);
      return;
    }

    const letter = {
      text: letterText,
      category,
      timestamp: new Date().toLocaleString(),
    };

    try {
      // 버튼 비활성화 및 로딩 상태 표시
      submitButton.disabled = true;
      submitButton.textContent = "보내는 중...";

      // 백엔드 서버에 편지 저장
      const response = await fetch(apiUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(letter),
      });

      if (!response.ok) {
        throw new Error("서버에 편지 저장 실패");
      }

      const savedLetter = await response.json();
      addLetterToList(savedLetter);

      // 입력창 초기화
      letterInput.value = "";
      categorySelect.value = "";
      document.getElementById("char-count").textContent = `0 / ${maxChars}자`;
    } catch (error) {
      console.error(error);
      alert("편지 전송 중 오류가 발생했습니다.");
    } finally {
      // 버튼 활성화 및 로딩 상태 해제
      submitButton.disabled = false;
      submitButton.textContent = "편지 보내기";
    }
  }
</script>
